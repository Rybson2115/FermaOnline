@model Experiment
@using FermaOnline.Models

<div class="container p-3">
    <div class="row pt-4">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <div class="d-flex justify-content-between">
                    <a asp-action="Index" class="btn btn-primary btn-lg ">Back</a>
                    <h2 class="text-primary center">@Model.Name</h2>
                    <a type="button" class="btn btn-primary btn-lg " asp-controller="Survey" asp-route-Id="@Model.Id" asp-action="Create">Add survey</a>
                </div>

            </div>
            <div class="card-body">

                <div class="d-flex justify-content-between">
                    <p class="align-text-bottom"><span class="fw-bold">id:</span> @Model.Code </p>
                    <p><span class="fw-bold">Author:</span> Jerzy Pastuszak</p>
                </div>
                <div class="d-flex justify-content-center">
                    @{var TextSpecies = @Model.Status ? "This experiment is conduct on" : "This experiment was conducted on";
                        <p class="fst-italic">@TextSpecies @Model.Species</p>
                    }
                </div>
                    <p class=".fs-1 text fw-bold">Abstract:</p>
                    <p>@Model.ShortDescription</p>

                    <p class=".fs-1 text fw-bold">Description:</p>
                    <p class="lh-base">@Html.Raw(@Model.Description)</p>



                </div>
            </div>
    </div>
    <br />

    @if (Model.SurveysList.Count != 0)
    {
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Table</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table ">
                        <thead>
                            <tr>
                                <th>Data</th>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <th>@survey.SurveyDate.!?ToString("dd/MM/yyyy")</th>
                                }
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Cage</td>
                                @{ char[] alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".ToCharArray();
                                    @foreach (var survey in Model.SurveysList)
                                    {
                                        <td>
                                            <table class="table mb-0">
                                                <tr>
                                                    @for (int i = 0; i < Model.CageNumber; i++)
                                                    {
                                                        <td>@alphabet[i] </td>
                                                    }
                                                </tr>
                                            </table>
                                        </td>
                                    }
                                }
                            </tr>
                            <tr>
                                <td>Loculus quantity </td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>@survey.LoculusQuantity </td>
                                }
                            </tr>
                            <tr>
                                <td>Cage quantity </td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>
                                        <table class="table mb-0">
                                            <tr>
                                                @foreach (var cage in survey.Cages)
                                                {
                                                    <td>@cage.CageQuantity</td>
                                                }
                                            </tr>
                                        </table>
                                    </td>
                                }
                            </tr>
                            <tr>
                                <td>Group Weight </td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>
                                        <table class="table mb-0">
                                            <tr>
                                                @foreach (var cage in survey.Cages)
                                                {
                                                    <td>@cage.GroupWeight </td>
                                                }
                                            </tr>
                                        </table>
                                    </td>
                                }
                            </tr>
                            <tr>
                                <td>Days from first weight</td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>@survey.DaysFromFirstWeight </td>
                                }
                            </tr>
                            <tr>
                                <td>Day Of Life</td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>@survey.DayOfLife </td>
                                }
                            </tr>
                            <tr>
                                <td>Individual body weight </td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>
                                        <table class="table mb-0">
                                            <tr>
                                                @foreach (var cage in survey.Cages)
                                                {
                                                    <td>@cage.IndividualBodyWeight </td>
                                                }
                                            </tr>
                                        </table>
                                    </td>
                                }
                            </tr>
                            <tr>
                                <td>Average body weight</td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>@survey.AverageBodyWeight </td>
                                }
                            </tr>
                            <tr>
                                <td>Difference in body weight </td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>
                                        <table class="table mb-0">
                                            <tr>
                                                @foreach (var cage in survey.Cages)
                                                {
                                                    <td>@cage.DifferenceInBodyWeight </td>
                                                }
                                            </tr>
                                        </table>
                                    </td>
                                }
                            </tr>
                            <tr>
                                <td>Weight gain from start </td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>
                                        <table class="table mb-0">
                                            <tr>
                                                @foreach (var cage in survey.Cages)
                                                {
                                                    <td>@cage.WeightGainFromStart </td>
                                                }
                                            </tr>
                                        </table>
                                    </td>

                                }
                            </tr>
                            <tr>
                                <td>Average weight gain</td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>@survey.AverageWeightGainFromCages </td>
                                }
                            </tr>
                            <tr>
                                <td>Weight gain from last survey</td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>
                                        <table class="table mb-0">
                                            <tr>
                                                @foreach (var cage in survey.Cages)
                                                {
                                                    <td>@cage.WeightGainFromLastSurvey </td>
                                                }
                                            </tr>
                                        </table>
                                    </td>
                                }
                            </tr>
                            <tr>
                                <td>Average weight gain from last survey</td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>@survey.AverageWeightGainFromLastSurvey </td>
                                }
                            </tr>
                            <tr>
                                <td>Loculus feed intake</td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>@survey.LoculusFeedInTake </td>
                                }
                            </tr>
                            <tr>
                                <td>Feed Intake Weekly</td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>@survey.FeedIntakeWeekly </td>
                                }
                            </tr>
                            <tr>
                                <td>FeedIntakDaily</td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>@survey.FeedIntakDaily </td>
                                }
                            </tr>
                            <tr>
                                <td>Feed Conversion Ratio</td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>@survey.FeedConversionRatio </td>
                                }
                            </tr>
                            <tr>
                                <td></td>
                                @foreach (var survey in Model.SurveysList)
                                {
                                    <td>  <a asp-controller="Survey" asp-action="Delete" asp-route-Id="@survey.SurveyId" class="btn btn-danger mx-1">Delete</a></td>
                                }

                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Charts</h6>
            </div>
            <div class="card-body">
                <div class="chart-line">
                    <div class="chartjs-size-monitor"><div class="chartjs-size-monitor-expand"><div class=""></div></div><div class="chartjs-size-monitor-shrink"><div class=""></div></div></div>
                    <canvas id="myChart" width="620" height="400" style="display: block; height: 320px; width: 496px;" class="chartjs-render-monitor"> </canvas>
                </div>
                <hr>
               <span class="fw-bold float-right"> BioDose 2020 </span>
            </div>
        </div>



        <script>
            var Days = [];
            var Weight = [];

            @{var dict = FermaOnline.Models.TemplateCurve.DefaultValuePig;
                var Weight = dict.Values.ToList();
                var Days = dict.Keys.ToList();

            @foreach (var day in Days)
             {
                  @: Days.push(@day);
            }

                 @foreach (var weight in Weight)
             {
                  @: Weight.push(parseFloat(@weight));
            }
        }
            new Chart(document.getElementById('myChart'), {
                type: 'line',
                data: {
                    labels: Days,
                    datasets: [{
                        data: Weight,
                        label: "Standard curve",
                        borderColor: "#3e95cd",
                        fill: false
                    }
                    ]
                },
                options: {
                    title: {
                        display: true,
                        text: 'Weight gain over time (G/DAYS)'
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                max: 140,
                                min: 5,
                                stepSize: 0.5
                            }
                        }]
                    }
                }
            });

        </script>
    }
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Nutrition Formula</h6>
        </div>
        <div class="card-body">

            <button class="btn" style="width:100%"><i class="fa fa-download"></i> Download Formula</button>

        </div>
    </div>

    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Materials and Methods</h6>
        </div>
        <div class="card-body">

            <a href="#">Preparation_of_CoProTex.pdf</a>

        </div>
    </div>
</div>

